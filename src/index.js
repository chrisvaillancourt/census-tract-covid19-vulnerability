require([
  'esri/Map',
  'esri/views/MapView',
  'esri/layers/VectorTileLayer',
  'esri/Basemap',
  'esri/layers/FeatureLayer',
], function (Map, MapView, VectorTileLayer, Basemap, FeatureLayer) {
  // const vectorBaseLayer = new VectorTileLayer({
  //   url: `https://www.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json`,
  // });
  // const vectorBaseReference = new VectorTileLayer({
  //   url: `https://www.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json`,
  //   opacity: 0.7,
  // });

  const vectorBaseLayer = new VectorTileLayer({
    url: `https://www.arcgis.com/sharing/rest/content/items/2afe5b807fa74006be6363fd243ffb30/resources/styles/root.json`,
  });
  const vectorBaseReference = new VectorTileLayer({
    url: `https://www.arcgis.com/sharing/rest/content/items/ba52238d338745b1a355407ec9df6768/resources/styles/root.json`,
    opacity: 0.7,
  });
  const vectorDetailLayer = new VectorTileLayer({
    url: `https://www.arcgis.com/sharing/rest/content/items/97fa1365da1e43eabb90d0364326bc2d/resources/styles/root.json`,
    opacity: 0.35,
  });

  const basemap = new Basemap({
    baseLayers: [vectorBaseLayer, vectorDetailLayer],
    referenceLayers: [vectorBaseReference],
  });

  const baseRenderer = {
    type: 'simple',
    symbol: {
      type: 'simple-fill',
      outline: {
        color: [145, 145, 145, 0.15],
        width: '0.5px',
      },
    },
    label: 'Census Tract',
    visualVariables: [
      {
        type: 'color',
        field: 'Covid_19_Vulnerability_Index',
        stops: [
          {
            value: '24',
            color: '#411b6d',
            label: '24',
          },
          {
            value: '43',
            color: '#fffee6',
            label: '43',
          },
          {
            value: '62',
            color: '#990b0b',
            label: '62',
          },
        ],
      },
    ],
  };

  const basePopupTemplate = {
    title: 'Tract {FIPS_text}',
    content:
      'The COVID-19 vulnerability index for this area is {Covid_19_Vulnerability_Index}.',
    fieldInfos: [
      {
        fieldName: 'Covid_19_Vulnerability_Index',
        format: {
          places: 0,
        },
      },
    ],
  };

  const featureLayer = new FeatureLayer({
    url:
      'https://services7.arcgis.com/Fnhc04BJL93uqCjd/ArcGIS/rest/services/COVID19_Vulnerability/FeatureServer/0',
    renderer: baseRenderer,
    popupEnabled: true,
    popupTemplate: basePopupTemplate,
    title: 'Census Tract',
  });
  const map = new Map({
    basemap,
    layers: [featureLayer],
  });
  const view = new MapView({
    container: 'viewDiv',
    map,
    center: [-98.5795, 39.8282],
    zoom: 3,
  });
});
